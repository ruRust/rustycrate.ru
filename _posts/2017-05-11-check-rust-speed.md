---
title: "Проверяем скорость Rust"
categories: размышления
author: Павел Никитин
---

Язык программирования Rust сосредоточен на безопасности, скорости и параллелизме. Давайте проверим, насколько Rust быстрый по сравнению с языками C и Vala. Для этого реализуем алгоритм решения интересной головоломки Lights Off на трёх компилируемых языках программирования и сравним их скорость.

### Задача
Дано прямоугольное поле, каждая ячейка которого включена или выключена. При переключении ячейки переключаются также её недиагональные соседи. Требуется выключить все ячейки за минимальное количество переключений.

### Решение
По заданному полю формируем систему логических уравнений с числом неизвестных, совпадающим с числом ячеек. Решаем систему методом Гаусса. Если ранг системы равен числу неизвестных, то получаем единственное решение. Иначе проверяем систему на противоречие. Если противоречия нет, то выбираем решение с минимальным весом среди подмножеств остатка за рангом системы.

### Реализация
Загружаем исходное поле в битовую матрицу. Битовая матрица является вектором битовых векторов. Битовый вектор хранится в массиве целых чисел без знака, разрядность которых совпадает с разрядностью платформы. По битовой матрице поля формируем битовую матрицу системы уравнений. Решаем систему методом Гаусса, выбираем решение с минимальным весом. Преобразуем битовый вектор решения в битовую матрицу результата и выводим её.

### Тестирование
* Поле 100 на 100, все ячейки которого включены
* Процессор Intel Core i5-7200U

### Производительность
#### С
14 секунд
#### Vala
202 секунды
#### Rust
4 секунды

### Разбор полётов
Алгоритм реализован на трёх компилируемых языках программирования, скомпилированные программы работают на одном и том же процессоре в условиях одинаковой нагрузки. Реализация на языке Vala оказалась существенно медленней реализаций на языках C и Rust. Анализ промежуточного исходного кода на языке C для реализации на языке Vala показал отсутствие выделения и освобождения памяти в циклах с большим количеством итераций, но обнаружил громоздкий код с большим количеством лишних инструкций, в результате чего результирующий машинный код оказался неэффективным.

### Перспективы
Метод Гаусса плохо поддаётся распараллеливанию, но перебор решений в случае, когда ранг системы меньше количества неизвестных, хорошо поддаётся распараллеливанию, что делает язык Rust приоритетным кандидатом с его выразительными возможностями распараллеливания вычислительных процессов.

### Заключение
Rust оправдывает звание скоростного языка программирования!

### Исходный код
https://github.com/doomkin/lightsoffsolver
