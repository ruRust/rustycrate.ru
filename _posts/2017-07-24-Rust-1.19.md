---
layout: post
categories: новости
title: "Выпуск Rust 1.19"
author: The Rust Core Team
translator: Илья Богданов
---

Команда Rust рада представить выпуск Rust 1.19. Rust - это системный язык программирования,
нацеленный на скорость, безопасность и параллельное выполнение кода.

Если у вас установлена предыдущая версия Rust, для обновления достаточно выполнить:

```bash
$ rustup update stable
```

Если же Rust еще не установлен, вы можете [установить `rustup`][install] с соответствующей
страницы нашего веб-сайта и ознакомится с [подробными примечаниями к выпуску Rust 1.19][notes] на GitHub.

[install]: https://www.rust-lang.org/install.html
[notes]:  https://github.com/rust-lang/rust/blob/rust-1.19.0-relnotes/RELEASES.md#version-1190-2017-07-20

<!--cut-->

### Что вошло в стабильную версию 1.19.0

В Rust 1.19.0 вошли некоторые долгожданные функции, но для начала, замечание для
пользователей Windows. На этой ОС Rust использует для сборки `link.exe`,
который входит в состав "Microsoft Visual C++ Build Tools". В последнем выпуске
Visual Studio 2017 структура директорий для этих инструментов изменилась. Из-за
этого вы были вынуждены использовать инструменты версии 2015 или изменять переменные
среды (например, запуская `vcvars.bat`). В Rust 1.19.0, `rustc` знает, как найти
инструменты версии 2017, поэтому вам не потребуется более использовать обходные пути.

А теперь к новым возможностям! Rust 1.19.0 - это первый выпуск, поддерживающий
[`union`]  (`Объединения`):

```rust
union MyUnion {
    f1: u32,
    f2: f32,
}
```

Объединения похожи на `enum` (`Перечисления`), но они не имеют "меток" в отличие
от последних. "Метка" в `enum` позволяет узнать во время исполнения, какой вариант
из перечисленных хранится в переменной.


Так как мы можем неверно интерпретировать данные, хранящиеся в объединении, и Rust
не может проверить это за нас, чтение и запись объединений небезопасны:

```rust
let u = MyUnion { f1: 1 };

unsafe { u.f1 = 5 };

let value = unsafe { u.f1 };
```

Сравнение с образцом (Pattern matching) также работает:

```rust
fn f(u: MyUnion) {
    unsafe {
        match u {
            MyUnion { f1: 10 } => { println!("десять"); }
            MyUnion { f2 } => { println!("{}", f2); }
        }
    }
}
```

Когда объединения полезны? Главная сфера применения - взаимодействие с C. C API
могут (и часто делают это) предоставлять объединения, так что написание оберток для
API значительно упрощается. Также, из [данного RFC]:

> Встроенная в языке поддержка объединений так же позволит упростить реализацию
> эффективных с точки зрения использования памяти или кэша структур, основанных на
> представлении значений, как, например, объединения размером машинного слова,
> используя младшие биты выровненных указателей.

Эту возможность ожидали с давних пор, и есть еще множество вещей, которые стоит
улучшить. На данный момент, объединения могу включать только типы, реализующие
`Copy`, и не могут реализовывать `Drop`.
Мы надеемся убрать эти ограничения в будущем.

[`union`]: https://github.com/rust-lang/rust/pull/42068
[данного RFC]: https://github.com/rust-lang/rfcs/blob/master/text/1444-union.md#motivation

> К слову, а вы когда-нибудь интересовались, как новые возможности
> добавляются в Rust? Объединения были предложены Josh Triplett, и он
> [выступил на RustConf 2016](https://youtu.be/U8Gl3RTXf88?list=PLE7tQUdRKcybLShxegjn0xyTTDJeYwEkI),
> рассказав про процесс интеграции. Вы должны на это взглянуть!

К другим новостям, [`loop` теперь могут возвращать значения через `break`](https://github.com/rust-lang/rust/pull/42016):

```rust
// старый код
let x;

loop {
    x = 7;
    break;
}

// новый код
let x = loop { break 7; };
```

Rust традиционно позиционировал себя как "язык, ориентированный на выражения (expression)",
большинство синтаксических конструкций возвращают значения, а не являются операторами
(statement). `loop` несколько выделялся из этого ряда, не возвращая значение.

Что насчет остальных циклов? Еще не ясно, смотрите обсуждение в [этом RFC](https://github.com/rust-lang/rfcs/blob/master/text/1624-loop-break-value.md#extension-to-for-while-while-let).

Небольшое улучшение: замыкания, не захватывающие окружение, [теперь могут быть
приведены к указателю на функцию](https://github.com/rust-lang/rust/pull/42162):

```rust
let f: fn(i32) -> i32 = |x| x + 1;
```

Теперь мы предоставляем [архивы запакованные `xz`](https://github.com/rust-lang/rust-installer/pull/57) и используем их по умолчанию,
что позволяет ускорить передачу данных. Сжатие с `gzip` все еще доступно, на случай
если вы не можете использовать `xz` по какой-либо причине.

Компилятор теперь может [запускаться на Android](https://github.com/rust-lang/rust/pull/41370).
Мы долгое время всячески поддерживали разработку на Android и наша поддержка
продолжает улучшаться.

В заключение, о совместимости. Ранее, когда мы двигались к Rust 1.0, мы проделали
большую работу, чтобы убедиться в том, что все отмечено как "стабильное" и "не стабильное".
Однако мы просмотрели одну вещь: `-Z` флаги. `-Z` флаг компилятора включает нестабильные
флаги. В отличие от всего остального, вы можете использовать `-Z` со стабильным
Rust. В апреле 2016, в Rust 1.8, мы добавили предупреждение при использовании
`-Z` со стабильной и бета версиями Rust. Более чем год спустя, мы починили эту
дыру в нашей истории стабильности, [запретив `-Z` везде, кроме ночных сборок компилятора]
(https://github.com/rust-lang/rust/pull/41751).

Смотрите [детальные заметки к выпуску][notes] для подробностей.

#### Стабилизация стандартной библиотеки

Крупнейшие изменения в стандартной библиотеке - [макросы `eprint!` и `eprintln!`].
Они работают точно так же, как `print!` и `println!`, но пишут в стандартный
вывод ошибок, а не в стандартный вывод.

[макросы `eprint!` и `eprintln!`]: https://github.com/rust-lang/rust/pull/41192

Другие изменения:

- [`String` теперь реализует `FromIterator<Cow<'a, str>>` и
  `Extend<Cow<'a, str>>`][41449]
- [`Vec` теперь реализует `From<&mut [T]>`][41530]
- [`Box<[u8]>` теперь реализует `From<Box<str>>`][41258]
- [`SplitWhitespace` теперь реализует `Clone`][41659]
- [`[u8]::reverse` теперь в 5 раз быстрее и `[u16]::reverse` теперь в 1.5 раза быстрее][41764]

[41449]: https://github.com/rust-lang/rust/pull/41449
[41530]: https://github.com/rust-lang/rust/pull/41530
[41258]: https://github.com/rust-lang/rust/pull/41258
[41659]: https://github.com/rust-lang/rust/pull/41659
[41764]: https://github.com/rust-lang/rust/pull/41764

И некоторые стабилизированные API:

- [`OsString::shrink_to_fit`]
- [`cmp::Reverse`]
- [`Command::envs`]
- [`thread::ThreadId`]

[`OsString::shrink_to_fit`]: https://doc.rust-lang.org/std/ffi/struct.OsString.html#method.shrink_to_fit
[`cmp::Reverse`]: https://doc.rust-lang.org/std/cmp/struct.Reverse.html
[`Command::envs`]: https://doc.rust-lang.org/std/process/struct.Command.html#method.envs
[`thread::ThreadId`]: https://doc.rust-lang.org/std/thread/struct.ThreadId.html

Смотрите [детальные заметки к выпуску][notes] для подробностей.

#### Улучшения Cargo

В этом выпуске в Cargo были добавлены небольшие, но важные улучшения. Крупнейшее
из них: [Cargo теперь работает непосредственно с git-объектами][cargo/4026]. Это
уменьшает размер реестра и ускоряет клонирование, особенно на Windows.

Другие улучшения:

- [Скрипты сборки теперь добавляют переменные окружения в окружение
  компилируемого контейнера (crate).
  Например: `println!("cargo:rustc-env=FOO=bar");`][cargo/3929]
- [Workspace.members теперь принимает шаблоны поиска.][cargo/3979]
- [Добавлен флаг `--all` для подкоманды `cargo bench`, чтобы запускать тесты
  производительности для всех контейнеров в рабочей области (workspace).][cargo/3988]
- [Добавлена опция `--exclude` для исключения некоторых контейнеров при использовании
  опции `--all`.][cargo/4031]
- [Опция `--features` теперь принимает несколько значений, разделенных запятой или
  пробелом.][cargo/4084]
- [Добавлена возможность настройки способа запуска исполняемых файлов при
  кросс-компиляции][cargo/3954]

[cargo/3929]: https://github.com/rust-lang/cargo/pull/3929
[cargo/3954]: https://github.com/rust-lang/cargo/pull/3954
[cargo/3979]: https://github.com/rust-lang/cargo/pull/3979
[cargo/3988]: https://github.com/rust-lang/cargo/pull/3988
[cargo/4026]: https://github.com/rust-lang/cargo/pull/4026
[cargo/4031]: https://github.com/rust-lang/cargo/pull/4031
[cargo/4084]: https://github.com/rust-lang/cargo/pull/4084

Смотрите [детальные заметки к выпуску][notes] для подробностей.

### Разработчики 1.19.0

Множество людей участвовало в разработке Rust 1.19. Мы не смогли бы этого добиться
без участия каждого из вас. [Спасибо!](https://thanks.rust-lang.org/rust/1.19.0)